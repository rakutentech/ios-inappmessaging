<!DOCTYPE html>
<html lang="en">
  <head>
    <title>README  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset='utf-8'>
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
    <script src="js/lunr.min.js" defer></script>
    <script src="js/typeahead.jquery.js" defer></script>
    <script src="js/jazzy.search.js" defer></script>
  </head>
  <body>
    <a title="README  Reference"></a>
    <header>
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
      <link rel="stylesheet" type="text/css" href="css/version-select.css" />
      <script src="js/version-select.js" defer></script>
      <script src="../versions.js"></script>
      <div class="content-wrapper">
        <p><a href="index.html">RInAppMessaging Docs</a></p>
        <div class="version-dropdown">
          <button onclick="toggleVersionSelect()" class="versionbtn">4.0.0 <i class="fa fa-caret-down"></i></button>
          <div id="versions" class="version-dropdown-content"></div>
        </div> 
        <p class="header-right"><a href="https://github.com/rakutentech/ios-inappmessaging"><img src="img/gh.png"/>View on GitHub</a></p>
        <p class="header-right">
          <form role="search" action="search.json">
            <input type="text" placeholder="Search documentation" data-typeahead>
          </form>
        </p>
      </div>
    </header>
    <div class="content-wrapper">
      <p id="breadcrumbs">
        <a href="index.html">RInAppMessaging Reference</a>
        <img id="carat" src="img/carat.png" />
        README  Reference
      </p>
    </div>
    <div class="content-wrapper">
      <nav class="sidebar">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a href="Guides.html">Guides</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="changelog.html">CHANGELOG</a>
              </li>
              <li class="nav-group-task">
                <a href="deploy.html">DEPLOY</a>
              </li>
              <li class="nav-group-task">
                <a href="readme.html">README</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/AppStartEvent.html">AppStartEvent</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CustomAttribute.html">CustomAttribute</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CustomEvent.html">CustomEvent</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Event.html">Event</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes.html#/c:@M@RInAppMessaging@objc(cs)IAMPreference">IAMPreference</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/IAMPreferenceBuilder.html">IAMPreferenceBuilder</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/LoginSuccessfulEvent.html">LoginSuccessfulEvent</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/PurchaseSuccessfulEvent.html">PurchaseSuccessfulEvent</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/RInAppMessaging.html">RInAppMessaging</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Enums.html">Enumerations</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Enums/Identification.html">Identification</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Protocols/RInAppMessagingDelegate.html">RInAppMessagingDelegate</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/RInAppMessagingErrorDelegate.html">RInAppMessagingErrorDelegate</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">
        <section>
          <section class="section">
            
            <p><img src="https://app.bitrise.io/app/ffc79d919e1efa04/status.svg?token=xJsKB2zDU77urYIJlqlKZg&branch=master" alt="Build Status">
<a href="https://codecov.io/gh/rakutentech/ios-inappmessaging"><img src="https://codecov.io/gh/rakutentech/ios-inappmessaging/branch/master/graph/badge.svg" alt="codecov"></a></p>
<h1 id='rinappmessaging' class='heading'>RInAppMessaging</h1>

<p>In-App Messaging (IAM) module allows app developers to easily configure and display notifications within their app.</p>

<p>This module supports iOS 11.0 and above. It has been tested with iOS 11.1 and above.</p>
<h1 id='strong-how-to-install-strong' class='heading'><strong>How to install</strong></h1>

<p>RInAppMessaging SDK is distributed as a Cocoapod.<br>
More information on installing pods: <a href="https://guides.cocoapods.org/using/getting-started.html">https://guides.cocoapods.org/using/getting-started.html</a></p>

<ol>
<li>Include the following in your application&rsquo;s Podfile</li>
</ol>
<pre class="highlight ruby"><code><span class="n">pod</span> <span class="s1">'RInAppMessaging'</span>
</code></pre>

<p><strong>Note:</strong> RInAppMessaging SDK requires <code>use_frameworks!</code> to be present in the Podfile.</p>

<ol>
<li>Run the following in the terminal</li>
</ol>
<pre class="highlight plaintext"><code>pod install
</code></pre>
<h1 id='strong-configuring-strong' class='heading'><strong>Configuring</strong></h1>

<p><strong>Note:</strong> Currently we do not host any public APIs but you can create your own APIs and configure the SDK to use those.</p>

<p>To use the module you must set the following values in your app&rsquo;s <code>Info.plist</code>:</p>

<table><thead>
<tr>
<th style="text-align: center">Key</th>
<th style="text-align: center">Value</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: center"><code>InAppMessagingAppSubscriptionID</code></td>
<td style="text-align: center">your_subscription_key</td>
</tr>
<tr>
<td style="text-align: center"><code>InAppMessagingConfigurationURL</code></td>
<td style="text-align: center">Endpoint for fetching the configuration</td>
</tr>
</tbody></table>
<h1 id='strong-using-the-sdk-strong' class='heading'><strong>Using the SDK</strong></h1>

<p>The SDK provides 3 public methods for the host applications to use:</p>

<ol>
<li><code>configure()</code></li>
<li><code>logEvent()</code></li>
<li><code>registerPreference()</code></li>
<li><code>closeMessage()</code></li>
</ol>
<h3 id='strong-configure-strong' class='heading'><strong>configure()</strong></h3>

<p>This method is called to initialize the SDK and should be placed in your AppDelegate&rsquo;s <code>didFinishLaunchingWithOptions</code>.</p>
<pre class="highlight swift"><code><span class="kd">import</span> <span class="kt">RInAppMessaging</span>

<span class="kd">func</span> <span class="nf">application</span><span class="p">(</span><span class="n">_</span> <span class="nv">application</span><span class="p">:</span> <span class="kt">UIApplication</span><span class="p">,</span> <span class="n">didFinishLaunchingWithOptions</span> <span class="nv">launchOptions</span><span class="p">:</span> <span class="p">[</span><span class="kt">UIApplicationLaunchOptionsKey</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]?)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
    <span class="kt">RInAppMessaging</span><span class="o">.</span><span class="nf">configure</span><span class="p">()</span>
    <span class="k">return</span> <span class="kc">true</span>
<span class="p">}</span>
</code></pre>
<h3 id='strong-logevent-strong' class='heading'><strong>logEvent()</strong></h3>

<p>This method is provided for the host application to log and save events. These events will be used to match campaign triggers.</p>

<p><strong>The method signature is:</strong></p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">logEvent</span><span class="p">(</span><span class="n">_</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">Event</span><span class="p">)</span>
</code></pre>

<p>IAM provides three pre-defined event types and a custom event type:</p>

<ol>
<li><code><a href="Classes/AppStartEvent.html">AppStartEvent</a></code> - This event should be logged when the application is considered started by the host app. E.G AppDelegate&rsquo;s didFinishLaunchingWithOptions. It is persistent, meaning, once it&rsquo;s logged it will always satisfy corresponding trigger in a campaign. All subsequent logs of this event are ignored. Campaigns that require only AppStartEvent are shown once per app launch.</li>
<li><code><a href="Classes/LoginSuccessfulEvent.html">LoginSuccessfulEvent</a></code> - This event should be logged whenever the user logs in successfully.</li>
<li><code><a href="Classes/PurchaseSuccessfulEvent.html">PurchaseSuccessfulEvent</a></code> - This event should be logged whenever a successful purchase occurs and has several pre-defined properties – purchase amount, number of items, currency code and item list.</li>
<li><code><a href="Classes/CustomEvent.html">CustomEvent</a></code> - This event is created by the host app developers and can take in any event name and a list of custom attributes.</li>
</ol>
<pre class="highlight swift"><code><span class="c1">// App start event.</span>
<span class="kt">RInAppMessaging</span><span class="o">.</span><span class="nf">logEvent</span><span class="p">(</span><span class="kt">AppStartEvent</span><span class="p">())</span>

<span class="c1">// Purchase successful event.</span>
<span class="k">let</span> <span class="nv">purchaseEvent</span> <span class="o">=</span> <span class="kt">PurchaseSuccessfulEvent</span><span class="p">()</span>
<span class="n">purchaseEvent</span><span class="o">.</span><span class="nf">setPurchaseAmount</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="n">purchaseEvent</span><span class="o">.</span><span class="nf">setItemList</span><span class="p">([</span><span class="s">"box"</span><span class="p">,</span> <span class="s">"hammer"</span><span class="p">])</span>
<span class="n">purchaseEvent</span><span class="o">.</span><span class="nf">setCurrencyCode</span><span class="p">(</span><span class="s">"USD"</span><span class="p">)</span>

<span class="kt">RInAppMessaging</span><span class="o">.</span><span class="nf">logEvent</span><span class="p">(</span><span class="n">purchaseEvent</span><span class="p">)</span>

<span class="c1">// Login event.</span>
<span class="kt">RInAppMessaging</span><span class="o">.</span><span class="nf">logEvent</span><span class="p">(</span><span class="kt">LoginSuccessfulEvent</span><span class="p">())</span>

<span class="c1">// Custom event.</span>
<span class="k">let</span> <span class="nv">stringAttribute</span> <span class="o">=</span> <span class="kt">CustomAttribute</span><span class="p">(</span><span class="nv">withKeyName</span><span class="p">:</span> <span class="s">"userResponse"</span><span class="p">,</span> <span class="nv">withStringValue</span><span class="p">:</span> <span class="s">"hi"</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">intAttribute</span> <span class="o">=</span> <span class="kt">CustomAttribute</span><span class="p">(</span><span class="nv">withKeyName</span><span class="p">:</span> <span class="s">"numberOfClicks"</span><span class="p">,</span> <span class="nv">withIntValue</span><span class="p">:</span> <span class="mi">100</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">boolAttribute</span> <span class="o">=</span> <span class="kt">CustomAttribute</span><span class="p">(</span><span class="nv">withKeyName</span><span class="p">:</span> <span class="s">"didNavigateToPage"</span><span class="p">,</span> <span class="nv">withBoolValue</span><span class="p">:</span> <span class="kc">false</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">doubleAttribute</span> <span class="o">=</span> <span class="kt">CustomAttribute</span><span class="p">(</span><span class="nv">withKeyName</span><span class="p">:</span> <span class="s">"percentageOfCompletion"</span><span class="p">,</span> <span class="nv">withDoubleValue</span><span class="p">:</span> <span class="mf">55.0</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">timeAttribute</span> <span class="o">=</span> <span class="kt">CustomAttribute</span><span class="p">(</span><span class="nv">withKeyName</span><span class="p">:</span> <span class="s">"timeOfCompletion"</span><span class="p">,</span> <span class="nv">withTimeInMilliValue</span><span class="p">:</span> <span class="mi">32423424</span><span class="p">)</span>

<span class="k">let</span> <span class="nv">attributesList</span> <span class="o">=</span> <span class="p">[</span><span class="n">stringAttribute</span><span class="p">,</span> <span class="n">intAttribute</span><span class="p">,</span> <span class="n">boolAttribute</span><span class="p">,</span> <span class="n">doubleAttribute</span><span class="p">,</span> <span class="n">timeAttribute</span><span class="p">]</span>

<span class="kt">RInAppMessaging</span><span class="o">.</span><span class="nf">logEvent</span><span class="p">(</span><span class="kt">CustomEvent</span><span class="p">(</span><span class="nv">withName</span><span class="p">:</span> <span class="s">"any_event_name_here"</span><span class="p">,</span> <span class="nv">withCustomAttributes</span><span class="p">:</span> <span class="n">attributesList</span><span class="p">))</span>
</code></pre>
<h3 id='strong-registerpreference-strong' class='heading'><strong>registerPreference()</strong></h3>

<p>A preference is what will allow IAM to identify users for targeting and segmentation. At the moment, IAM will take in any of the following identifiers:</p>

<ol>
<li>RakutenID</li>
<li>UserID - The ID when registering a Rakuten account. e.g. an email address</li>
<li>AccessToken - This is the token provided by the internal RAuthentication SDK as the &ldquo;accessToken&rdquo; value</li>
</ol>

<p>To help IAM identify users, please set a new preference every time a user changes their login state i.e. when they log in or log out.<br>
After logout is complete please call  <code>registerPreference()</code> with nil parameter.<br>
Not all identifiers have to be provided.<br>
<strong>NOTE:</strong> For our internal users - for user targeting you must provide an accessToken. If you are setting an accessToken you must also provide associated userId in <code><a href="Classes.html#/c:@M@RInAppMessaging@objc(cs)IAMPreference">IAMPreference</a></code>.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">preference</span> <span class="o">=</span> <span class="kt">IAMPreferenceBuilder</span><span class="p">()</span>
    <span class="o">.</span><span class="nf">setUserId</span><span class="p">(</span><span class="s">"testaccount@gmail.com"</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">setRakutenId</span><span class="p">(</span><span class="s">"testaccount"</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">setAccessToken</span><span class="p">(</span><span class="s">"27364827346"</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">build</span><span class="p">()</span>

<span class="kt">RInAppMessaging</span><span class="o">.</span><span class="nf">registerPreference</span><span class="p">(</span><span class="n">preference</span><span class="p">)</span>
</code></pre>
<h3 id='strong-closemessage-strong' class='heading'><strong>closeMessage()</strong></h3>

<p>In certain cases there might be a need to manually close a campaign&rsquo;s message without user interaction.
An example is when a different user logs in and the currently displayed campaign does not target the new user.
(Or when a campaign&rsquo;s message appears after login process has started).
In that case, to avoid user&rsquo;s confusion, host app can force-close the campaign by calling <code>closeMessage()</code> API method.
The <code>clearQueuedCampaigns</code> optional parameter, when set to <code>true</code> (<code>false</code> by default), will additionally remove all campaigns that were queued to be displayed.</p>
<pre class="highlight swift"><code><span class="kt">RInAppMessaging</span><span class="o">.</span><span class="nf">closeMessage</span><span class="p">(</span><span class="nv">clearQueuedCampaigns</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
</code></pre>

<p><strong>Note:</strong> Calling this API will not increment the campaign&rsquo;s impression (i.e. not counted as displayed).</p>
<h2 id='strong-custom-events-strong' class='heading'><strong>Custom Events</strong></h2>

<p>As shown in the example above for event logging, IAM also supports custom event. Custom events are events with an unique name and a list of attributes associated with them.</p>

<p>In order to properly utilize custom events, the person creating the campaign must sync up with the host app developers to ensure that both the event name and attribute name/value exactly match exactly - note that these are case-sensitive.</p>

<p>From the dashboard side, you will have the ability to also add an operator. The following operators are supported:<br>
1) <code>EQUALS</code> - The values should be equal. In terms of timeInMillis, there will be a tolerance of 1000 milliseconds. E.G 1001 and 500 milliseconds will be considered equal.<br>
2) <code>IS_NOT_EQUAL</code> - The values should be different. In terms of timeInMillis, there will be a tolerance of 1000 milliseconds. E.G 1001 and 500 milliseconds will be considered equal.<br>
3) <code>GREATER_THAN</code> - The event attribute value is greater than the campaign&rsquo;s trigger value. Applies to only arithmetic types.<br>
4) <code>LESS_THAN</code> - The event attribute value is less than the campaign&rsquo;s trigger value. Applies to only arithmetic types.<br>
5) <code>IS_BLANK</code> - The attribute value is empty. Applies to only String type only.<br>
6) <code>IS_NOT_BLANK</code> - The attribute value is not empty. Applied to String type only.<br>
7) <code>MATCHES_REGEX</code> - The attribute value matches the regular expression. Applies to only String type.<br>
8) <code>DOES_NOT_MATCH_REGEX</code> - The attribute value does not match the regular expression. Applies to only String type string.</p>

<p><em>Note:</em> When comparing date as timeInMillis values, there is a tolerance of 1000 milliseconds. This means that comparisons using any relevant operator types will have a leniency of 1 second. E.g. comparing 300ms and 600ms with the <code>EQUALS</code> operator will return <code>true</code>, while comparing 300 and 1400 will return <code>false</code>.</p>

<p>From the SDK side, host app developers will be able to log custom events as shown in the examples above. When the event matching process happens, note that the attributes of the event logged by the host app will be compared against the campaign&rsquo;s trigger attribute value e.g. if the trigger attribute value is an integer of 5 with an operator type of <code>GREATER_THAN</code>, and the attribute value of the event logged is an integer 10, then the 10 will be successfully matched against the 5 with a <code>GREATER_THAN</code> operator (i.e. 10 &gt; 5).</p>
<h2 id='strong-optional-features-strong' class='heading'><strong>Optional features</strong></h2>
<h3 id='strong-rinappmessagingdelegate-strong' class='heading'><strong>RInAppMessagingDelegate</strong></h3>

<p>An optional delegate. Set the <code><a href="Classes/RInAppMessaging.html#/c:@M@RInAppMessaging@objc(cs)RInAppMessaging(cpy)delegate">RInAppMessaging.delegate</a></code> and implement the protocol method <code>inAppMessagingShouldShowCampaignWithContexts(contexts:campaignTitle:)</code> in order to be called before a message is displayed when a campaign title contains one or more contexts. A context is defined as the text inside &ldquo;[]&rdquo; within an IAM portal &ldquo;Campaign Name&rdquo; e.g. the campaign name is &ldquo;[ctx1] title&rdquo; so the context is &ldquo;ctx1&rdquo;.</p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">inAppMessagingShouldShowCampaignWithContexts</span><span class="p">(</span><span class="nv">contexts</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">],</span> <span class="nv">campaignTitle</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
    <span class="k">guard</span> <span class="n">campaignTitle</span> <span class="o">==</span> <span class="s">"[context1] campaign-title-1"</span><span class="p">,</span> <span class="n">contexts</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="s">"context1"</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">true</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="cm">/* check your condition e.g. are you on the correct screen to display this message? */</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">true</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<h3 id='strong-rinappmessagingerrordelegate-strong' class='heading'><strong>RInAppMessagingErrorDelegate</strong></h3>

<p>An optional error delegate. Set the <code><a href="Classes/RInAppMessaging.html#/c:@M@RInAppMessaging@objc(cs)RInAppMessaging(cpy)errorDelegate">RInAppMessaging.errorDelegate</a></code> and implement the protocol method <code>inAppMessagingDidReturnError(error:)</code> to receive an <code>NSError</code> object whenever an internal SDK error occurs. This allows you to log the errors somewhere, e.g. a 3rd party analytics service, for later troubleshooting.</p>
<h3 id='strong-bool-accessibilitycompatibledisplay-strong' class='heading'><strong>(BOOL)accessibilityCompatibleDisplay</strong></h3>

<p>This flag can be used to support UI test automation tools like Appium. When set to <code>true</code>, the SDK will use a different display method which changes campaign messages&rsquo; view hierarchy. This can solve issues with accessibility tools having problems detecting visible items.
 <strong>Note</strong>: There is a possibility that changing this flag will cause campaigns to display incorrectly.</p>
<pre class="highlight swift"><code><span class="kd">import</span> <span class="kt">RInAppMessaging</span>

<span class="kd">func</span> <span class="nf">application</span><span class="p">(</span><span class="n">_</span> <span class="nv">application</span><span class="p">:</span> <span class="kt">UIApplication</span><span class="p">,</span> <span class="n">didFinishLaunchingWithOptions</span> <span class="nv">launchOptions</span><span class="p">:</span> <span class="p">[</span><span class="kt">UIApplicationLaunchOptionsKey</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]?)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
    <span class="kt">RInAppMessaging</span><span class="o">.</span><span class="n">accessibilityCompatibleDisplay</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="k">return</span> <span class="kc">true</span>
<span class="p">}</span>
</code></pre>
<h2 id='strong-build-run-example-application-and-unit-tests-strong' class='heading'><strong>Build/Run Example Application and Unit Tests</strong></h2>

<ul>
<li>Clone or fork the repo</li>
<li><code>cd</code> to the repo folder</li>
<li>Set env vars <code>RIAM_CONFIG_URL</code> and <code>RIAM_APP_SUBSCRIPTION_KEY</code> according to the internal integration guide</li>
<li><em>Important Note</em>: <code>Example-Secrets.xcconfig</code> <strong>MUST NOT</strong> be committed to git - it is ignored by git in the repo&rsquo;s <code>.gitignore</code> file</li>
<li>Run <code>bundle install</code> then run <code>bundle exec pod install</code></li>
<li>Open <code>RInAppMessaging.xcworkspace</code> in Xcode then build/run</li>
<li>To run the tests press key shortcut command-U</li>
</ul>
<h1 id='strong-sdk-logic-strong' class='heading'><strong>SDK Logic</strong></h1>
<h2 id='user-cache' class='heading'>User cache</h2>

<p>Each user has a separate cache container that is persisted in UserDefaults. Each combination of rakutenId and userId is treated as a different user including a special - anonymous user - that represents non logged-in user (rakutenId and userId are null or empty).
The cache stores data from ping response enriched with impressions counter and opt-out status.
Calling <code>registerPerference()</code> reloads the cache and refreshes the list of available campaigns (with ping request).</p>
<h2 id='client-side-opt-out-handling' class='heading'>Client-side opt-out handling</h2>

<p>If user (with registered identifier using <code>registerPerference()</code>) opts out from a campaign, that information is saved in user cache locally on the device and the campaign won&rsquo;t be shown again for that user on the same device. The opt-out status is not shared between devices. The same applies for anonymous user.</p>
<h2 id='client-side-max-impressions-handling' class='heading'>Client-side max impressions handling</h2>

<p>Campaign impressions (displays) are counted locally for each user. Meaning that a campaign with maxImpression value of 3 will be displayed to each user (registered with <code>registerPerference()</code>) max 3 times. Campaign&rsquo;s max impression number can be modified in the dashboard/backend. Then the SDK, after next ping call, will compare new value with old max impression number and add the difference to the current impression counter. The max impression data is not shared between devices. The same applies for anonymous user.</p>
<h1 id='strong-troubleshooting-amp-f-a-q-strong' class='heading'><strong>Troubleshooting &amp; F.A.Q.</strong></h1>

<ul>
<li>Configuration service returns <code>RequestError.missingMetadata</code> error

<ul>
<li>Ensure that IAM SDK is integrated properly (not as a static library)</li>
</ul></li>
<li>Getting HTTP error 401

<ul>
<li>If you are providing an access token in <code><a href="Classes.html#/c:@M@RInAppMessaging@objc(cs)IAMPreference">IAMPreference</a></code> make sure that it comes from PROD endpoint. (this applies only to Rakuten developers)</li>
</ul></li>
<li>User targeting is not working

<ul>
<li>For user targeting to work you must provide <em>userId</em> or <em>rakutenId</em> in <code><a href="Classes.html#/c:@M@RInAppMessaging@objc(cs)IAMPreference">IAMPreference</a></code>.</li>
<li>If you are setting an <em>accessToken</em> you must also provide associated <em>userId</em>. (Rakuten developers only)</li>
</ul></li>
<li>Status bar characters and icons are not visible when Full-Screen campaign is presented

<ul>
<li>If your app is running on iOS version below 13.0 you need to either change background color of the campaign or set proper <code>preferredStatusbarStyle</code> in the top-most view controller. (for iOS versions above 13.0 this issue is handled internally by the SDK)</li>
</ul></li>
</ul>
<h4 id='for-other-issues-and-more-detailed-information-rakuten-developers-should-refer-to-the-troubleshooting-guide-on-the-internal-developer-documentation-portal' class='heading'>For other issues and more detailed information, Rakuten developers should refer to the Troubleshooting Guide on the internal developer documentation portal.</h4>

          </section>
        </section>
        <section id="footer">
          <p>&copy; 2021 <a class="link" href="https://github.com/rakutentech/ios-inappmessaging" target="_blank" rel="external">Rakuten Group, Inc.</a>. All rights reserved. (Last updated: 2021-06-22)</p>
          <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.13.7</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external">Realm</a> project.</p>
        </section>
      </article>
    </div>
  </body>
</div>
</html>
