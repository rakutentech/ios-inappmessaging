<!DOCTYPE html>
<html lang="en">
  <head>
    <title>RInAppMessaging  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset='utf-8'>
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
    <script src="js/lunr.min.js" defer></script>
    <script src="js/typeahead.jquery.js" defer></script>
    <script src="js/jazzy.search.js" defer></script>
  </head>
  <body>
    <a title="RInAppMessaging  Reference"></a>
    <header>
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
      <link rel="stylesheet" type="text/css" href="css/version-select.css" />
      <script src="js/version-select.js" defer></script>
      <script src="../versions.js"></script>
      <div class="content-wrapper">
        <p><a href="index.html">RInAppMessaging Docs</a></p>
        <div class="version-dropdown">
          <button onclick="toggleVersionSelect()" class="versionbtn">8.1.0 <i class="fa fa-caret-down"></i></button>
          <div id="versions" class="version-dropdown-content"></div>
        </div> 
        <p class="header-right"><a href="https://github.com/rakutentech/ios-inappmessaging"><img src="img/gh.png"/>View on GitHub</a></p>
        <p class="header-right">
          <form role="search" action="search.json">
            <input type="text" placeholder="Search documentation" data-typeahead>
          </form>
        </p>
      </div>
    </header>
    <div class="content-wrapper">
      <p id="breadcrumbs">
        <a href="index.html">RInAppMessaging Reference</a>
        <img id="carat" src="img/carat.png" />
        RInAppMessaging  Reference
      </p>
    </div>
    <div class="content-wrapper">
      <nav class="sidebar">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a href="Guides.html">Guides</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="changelog.html">CHANGELOG</a>
              </li>
              <li class="nav-group-task">
                <a href="contributing.html">CONTRIBUTING</a>
              </li>
              <li class="nav-group-task">
                <a href="deploy.html">DEPLOY</a>
              </li>
              <li class="nav-group-task">
                <a href="readme.html">README</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/AppStartEvent.html">AppStartEvent</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CustomAttribute.html">CustomAttribute</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CustomEvent.html">CustomEvent</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Event.html">Event</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/LoginSuccessfulEvent.html">LoginSuccessfulEvent</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/PurchaseSuccessfulEvent.html">PurchaseSuccessfulEvent</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/RInAppMessaging.html">RInAppMessaging</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Extensions.html">Extensions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Extensions/UITabBar.html">UITabBar</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/View.html">View</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Protocols/UserInfoProvider.html">UserInfoProvider</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">
        <section>
          <section class="section">
            
            <p><img src="https://app.bitrise.io/app/ffc79d919e1efa04/status.svg?token=xJsKB2zDU77urYIJlqlKZg&branch=master" alt="Build Status">
<a href="https://codecov.io/gh/rakutentech/ios-inappmessaging"><img src="https://codecov.io/gh/rakutentech/ios-inappmessaging/branch/master/graph/badge.svg" alt="codecov"></a>
<a href="https://sonarcloud.io/summary/new_code?id=rakutentech_ios-inappmessaging"><img src="https://sonarcloud.io/api/project_badges/measure?project=rakutentech_ios-inappmessaging&metric=alert_status" alt="Quality Gate Status"></a></p>
<h1 id='rinappmessaging' class='heading'>RInAppMessaging</h1>

<p>In-App Messaging (IAM) module allows app developers to easily configure and display notifications within their app.</p>

<p>This module supports iOS 12.0 and above. It has been tested with iOS 12.5 and above.</p>
<h1 id='requirements' class='heading'>Requirements</h1>

<p>Xcode &gt;= 14.1 is supported.</p>

<p>Swift &gt;= 5.7.1 is supported.</p>

<p>Note: The SDK may build on earlier Xcode versions but it is not officially supported or tested.</p>
<h1 id='strong-how-to-install-strong' class='heading'><strong>How to install</strong></h1>

<p>RInAppMessaging SDK is distributed as a Cocoapod and as a Swift Package.</p>
<h2 id='cocoapods' class='heading'>CocoaPods</h2>

<p>More information on installing pods: <a href="https://guides.cocoapods.org/using/getting-started.html">https://guides.cocoapods.org/using/getting-started.html</a></p>

<ol>
<li>Include the following in your application&rsquo;s Podfile</li>
</ol>
<pre class="highlight ruby"><code><span class="n">pod</span> <span class="s1">'RInAppMessaging'</span>
</code></pre>

<p><strong>Note:</strong> RInAppMessaging SDK requires <code>use_frameworks!</code> to be present in the Podfile.</p>

<ol>
<li>Run the following in the terminal</li>
</ol>
<pre class="highlight plaintext"><code>pod install
</code></pre>
<h2 id='swift-package-manager' class='heading'>Swift Package Manager</h2>

<p>Open your project settings in Xcode and add a new package in &lsquo;Swift Packages&rsquo; tab:</p>

<ul>
<li>Repository URL: <code>https://github.com/rakutentech/ios-inappmessaging.git</code></li>
</ul><div class="aside aside-version">
    <p class="aside-title">Version</p>
    Version settings: 6.1.0 &ldquo;Up to Next Major&rdquo; (6.1.0 is the first version to support SPM)

</div>

<p>Choose <code><a href="Classes/RInAppMessaging.html">RInAppMessaging</a></code> product for your target. If you want to link other targets, go to Build Phases of that target, then in Link Binary With Libraries click + button and add <code><a href="Classes/RInAppMessaging.html">RInAppMessaging</a></code>.</p>
<h1 id='strong-configuring-strong' class='heading'><strong>Configuring</strong></h1>

<p><strong>Note:</strong> Currently we do not host any public APIs but you can create your own APIs and configure the SDK to use those.</p>

<p>To use the module you must set your app&rsquo;s subscription key and a config endpoint URL using one of the provided methods:</p>
<h3 id='build-time-configuration-a-name-build-time-config-a' class='heading'>Build-time configuration<a name="build-time-config"></a></h3>

<p>Add the following entries in your app&rsquo;s <code>Info.plist</code>:</p>

<table><thead>
<tr>
<th style="text-align: center">Key</th>
<th style="text-align: center">Value</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: center"><code>InAppMessagingAppSubscriptionID</code></td>
<td style="text-align: center">your_subscription_key</td>
</tr>
<tr>
<td style="text-align: center"><code>InAppMessagingConfigurationURL</code></td>
<td style="text-align: center">Endpoint for fetching the configuration</td>
</tr>
</tbody></table>
<h3 id='runtime-configuration' class='heading'>Runtime configuration</h3>

<p>Provide a value for <code>subscriptionID</code> and <code>configurationURL</code> parameters when calling <code>RInAppMessaging.configure</code> method. </p>
<pre class="highlight swift"><code><span class="kt">RInAppMessaging</span><span class="o">.</span><span class="nf">configure</span><span class="p">(</span><span class="nv">subscriptionID</span><span class="p">:</span> <span class="s">"your_subscription_key"</span><span class="p">,</span>
                          <span class="nv">configurationURL</span><span class="p">:</span> <span class="s">"Endpoint for fetching the configuration"</span><span class="p">)</span>
</code></pre>

<p>⚠️ The runtime configuration values take precedence over build-time configuration.</p>
<h2 id='strong-enable-and-disable-the-sdk-remotely-strong' class='heading'><strong>Enable and disable the SDK remotely</strong></h2>

<p>We recommend, as good engineering practice, that you integrate with a remote config service so that you can fetch a feature flag, e.g. <code>Enable_IAM_SDK</code>, and use its value to dynamically enable/disable the SDK without making an app release. There are many remote config services on the market, both free and paid.</p>
<h1 id='strong-using-the-sdk-strong' class='heading'><strong>Using the SDK</strong></h1>

<p>The SDK provides 3 public methods for the host applications to use:</p>

<ol>
<li><code>configure()</code></li>
<li><code>logEvent()</code></li>
<li><code>registerPreference()</code></li>
<li><code>closeMessage()</code></li>
</ol>
<h3 id='strong-configure-strong' class='heading'><strong>configure()</strong></h3>

<p>This method initializes the SDK and should be placed in your AppDelegate&rsquo;s <code>didFinishLaunchingWithOptions</code>.</p>
<pre class="highlight swift"><code><span class="kd">import</span> <span class="kt">RInAppMessaging</span>

<span class="kd">func</span> <span class="nf">application</span><span class="p">(</span><span class="n">_</span> <span class="nv">application</span><span class="p">:</span> <span class="kt">UIApplication</span><span class="p">,</span> <span class="n">didFinishLaunchingWithOptions</span> <span class="nv">launchOptions</span><span class="p">:</span> <span class="p">[</span><span class="kt">UIApplicationLaunchOptionsKey</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]?)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
    <span class="kt">RInAppMessaging</span><span class="o">.</span><span class="nf">configure</span><span class="p">(</span><span class="nv">subscriptionID</span><span class="p">:</span> <span class="s">"runtime-config-subscription-id"</span><span class="p">,</span>
                              <span class="nv">configurationURL</span><span class="p">:</span> <span class="s">"runtime.config.url"</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">true</span>
<span class="p">}</span>
</code></pre>

<p><strong>Note</strong>: </p>

<ul>
<li><code>subscriptionID</code> and <code>configurationURL</code> parameters are optional if you set their values in Info.plist (See <a href="#build-time-config">build-time configuration</a>)</li>
<li>You can wrap the call to <code>configure()</code> in an <code>if &lt;enable IAM-SDK boolean value&gt; == true</code> condition to control enabling/disabling the SDK.</li>
<li>If <code>configure()</code> is not called, subsequent calls to other public API SDK get retained and get triggered after <code>configure()</code> is called.</li>
<li>If RMC SDK is used for installing IAM SDK then RMC SDK configuration should be followed rather than IAM configuration.</li>
</ul>
<h3 id='strong-logevent-strong' class='heading'><strong>logEvent()</strong></h3>

<p>This method is provided for the host application to log and save events. These events will be used to match campaign triggers.</p>

<p><strong>The method signature is:</strong></p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">logEvent</span><span class="p">(</span><span class="n">_</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">Event</span><span class="p">)</span>
</code></pre>

<p>IAM provides three pre-defined event types and a custom event type:</p>

<ol>
<li><code><a href="Classes/AppStartEvent.html">AppStartEvent</a></code> - This event should be logged when the application is considered started by the host app. E.G AppDelegate&rsquo;s didFinishLaunchingWithOptions. It is persistent, meaning, once it&rsquo;s logged it will always satisfy corresponding trigger in a campaign. All subsequent logs of this event are ignored. Campaigns that require only AppStartEvent are shown once per app launch.</li>
<li><code><a href="Classes/LoginSuccessfulEvent.html">LoginSuccessfulEvent</a></code> - This event should be logged whenever the user logs in successfully.</li>
<li><code><a href="Classes/PurchaseSuccessfulEvent.html">PurchaseSuccessfulEvent</a></code> - This event should be logged whenever a successful purchase occurs and has several pre-defined properties – purchase amount, number of items, currency code and item list.</li>
<li><code><a href="Classes/CustomEvent.html">CustomEvent</a></code> - This event is created by the host app developers and can take in any event name and a list of custom attributes.</li>
</ol>
<pre class="highlight swift"><code><span class="c1">// App start event.</span>
<span class="kt">RInAppMessaging</span><span class="o">.</span><span class="nf">logEvent</span><span class="p">(</span><span class="kt">AppStartEvent</span><span class="p">())</span>

<span class="c1">// Purchase successful event.</span>
<span class="k">let</span> <span class="nv">purchaseEvent</span> <span class="o">=</span> <span class="kt">PurchaseSuccessfulEvent</span><span class="p">()</span>
<span class="n">purchaseEvent</span><span class="o">.</span><span class="nf">setPurchaseAmount</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="n">purchaseEvent</span><span class="o">.</span><span class="nf">setItemList</span><span class="p">([</span><span class="s">"box"</span><span class="p">,</span> <span class="s">"hammer"</span><span class="p">])</span>
<span class="n">purchaseEvent</span><span class="o">.</span><span class="nf">setCurrencyCode</span><span class="p">(</span><span class="s">"USD"</span><span class="p">)</span>

<span class="kt">RInAppMessaging</span><span class="o">.</span><span class="nf">logEvent</span><span class="p">(</span><span class="n">purchaseEvent</span><span class="p">)</span>

<span class="c1">// Login event.</span>
<span class="kt">RInAppMessaging</span><span class="o">.</span><span class="nf">logEvent</span><span class="p">(</span><span class="kt">LoginSuccessfulEvent</span><span class="p">())</span>

<span class="c1">// Custom event.</span>
<span class="k">let</span> <span class="nv">stringAttribute</span> <span class="o">=</span> <span class="kt">CustomAttribute</span><span class="p">(</span><span class="nv">withKeyName</span><span class="p">:</span> <span class="s">"userResponse"</span><span class="p">,</span> <span class="nv">withStringValue</span><span class="p">:</span> <span class="s">"hi"</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">intAttribute</span> <span class="o">=</span> <span class="kt">CustomAttribute</span><span class="p">(</span><span class="nv">withKeyName</span><span class="p">:</span> <span class="s">"numberOfClicks"</span><span class="p">,</span> <span class="nv">withIntValue</span><span class="p">:</span> <span class="mi">100</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">boolAttribute</span> <span class="o">=</span> <span class="kt">CustomAttribute</span><span class="p">(</span><span class="nv">withKeyName</span><span class="p">:</span> <span class="s">"didNavigateToPage"</span><span class="p">,</span> <span class="nv">withBoolValue</span><span class="p">:</span> <span class="kc">false</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">doubleAttribute</span> <span class="o">=</span> <span class="kt">CustomAttribute</span><span class="p">(</span><span class="nv">withKeyName</span><span class="p">:</span> <span class="s">"percentageOfCompletion"</span><span class="p">,</span> <span class="nv">withDoubleValue</span><span class="p">:</span> <span class="mf">55.0</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">timeAttribute</span> <span class="o">=</span> <span class="kt">CustomAttribute</span><span class="p">(</span><span class="nv">withKeyName</span><span class="p">:</span> <span class="s">"timeOfCompletion"</span><span class="p">,</span> <span class="nv">withTimeInMilliValue</span><span class="p">:</span> <span class="mi">32423424</span><span class="p">)</span>

<span class="k">let</span> <span class="nv">attributesList</span> <span class="o">=</span> <span class="p">[</span><span class="n">stringAttribute</span><span class="p">,</span> <span class="n">intAttribute</span><span class="p">,</span> <span class="n">boolAttribute</span><span class="p">,</span> <span class="n">doubleAttribute</span><span class="p">,</span> <span class="n">timeAttribute</span><span class="p">]</span>

<span class="kt">RInAppMessaging</span><span class="o">.</span><span class="nf">logEvent</span><span class="p">(</span><span class="kt">CustomEvent</span><span class="p">(</span><span class="nv">withName</span><span class="p">:</span> <span class="s">"any_event_name_here"</span><span class="p">,</span> <span class="nv">withCustomAttributes</span><span class="p">:</span> <span class="n">attributesList</span><span class="p">))</span>
</code></pre>
<h3 id='strong-registerpreference-strong' class='heading'><strong>registerPreference()</strong></h3>

<p>A preference is what will allow IAM to identify users for targeting and segmentation. Preference object should implement <code><a href="Protocols/UserInfoProvider.html">UserInfoProvider</a></code> protocol and provide any of the following identifiers (not all need to be provided):</p>

<ol>
<li>UserID - An unique identifier associated with user membership. Usually it&rsquo;s the name used in login process (e.g. an email address).</li>
<li>IDTrackingIdentifier - The value provided by the internal ID SDK as the &ldquo;tracking identifier&rdquo; value.</li>
<li>AccessToken - This is the token provided by the internal RAuthentication SDK as the &ldquo;accessToken&rdquo; value</li>
</ol>

<p>⚠️ The method is designed to be called ONCE once per app session - i.e. only one instance of <code><a href="Protocols/UserInfoProvider.html">UserInfoProvider</a></code> can be created. IAM SDK will read object&rsquo;s properties on demand. There&rsquo;s no need to call this method again after login/logout for example.</p>

<p>To ensure correct user targeting, please keep user information in the preference object up to date.
After logout process is complete the preference object should return <code>nil</code> or <code>&quot;&quot;</code> in all <code><a href="Protocols/UserInfoProvider.html">UserInfoProvider</a></code> methods.<br>
Preferences are not persisted so this function needs to be called on every launch.</p>
<h4 id='generic-example-using-userid' class='heading'>Generic example using UserID</h4>
<pre class="highlight swift"><code><span class="kd">import</span> <span class="kt">RInAppMessaging</span>

<span class="kd">class</span> <span class="kt">UserPreference</span><span class="p">:</span> <span class="kt">UserInfoProvider</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">getUserID</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">String</span><span class="p">?</span> <span class="p">{</span> 
        <span class="s">"member-id"</span> 
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">getIDTrackingIdentifier</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">String</span><span class="p">?</span> <span class="p">{</span> <span class="kc">nil</span> <span class="p">}</span>
    <span class="kd">func</span> <span class="nf">getAccessToken</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">String</span><span class="p">?</span> <span class="p">{</span> <span class="kc">nil</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">preference</span> <span class="o">=</span> <span class="kt">UserPreference</span><span class="p">()</span>
<span class="kt">RInAppMessaging</span><span class="o">.</span><span class="nf">registerPreference</span><span class="p">(</span><span class="n">preference</span><span class="p">)</span>
</code></pre>
<h3 id='strong-closemessage-strong' class='heading'><strong>closeMessage()</strong></h3>

<p>In certain cases there might be a need to manually close a campaign&rsquo;s message without user interaction.
An example is when a different user logs in and the currently displayed campaign does not target the new user.
(Or when a campaign&rsquo;s message appears after login process has started).
In that case, to avoid user&rsquo;s confusion, host app can force-close the campaign by calling <code>closeMessage()</code> API method.
The <code>clearQueuedCampaigns</code> optional parameter, when set to <code>true</code> (<code>false</code> by default), will additionally remove all campaigns that were queued to be displayed.</p>
<pre class="highlight swift"><code><span class="kt">RInAppMessaging</span><span class="o">.</span><span class="nf">closeMessage</span><span class="p">(</span><span class="nv">clearQueuedCampaigns</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
</code></pre>

<p><strong>Note:</strong> Calling this API will not increment the campaign&rsquo;s impression (i.e. not counted as displayed).</p>
<h2 id='strong-custom-events-strong' class='heading'><strong>Custom Events</strong></h2>

<p>As shown in the example above for event logging, IAM also supports custom event. Custom events are events with an unique name and a list of attributes associated with them.</p>

<p>In order to properly utilize custom events, the person creating the campaign must sync up with the host app developers to ensure that both the event name and attribute name/value exactly match exactly - note that these are case-sensitive.</p>

<p>From the dashboard side, you will have the ability to also add an operator. The following operators are supported:<br>
1) <code>EQUALS</code> - The values should be equal. In terms of timeInMillis, there will be a tolerance of 1000 milliseconds. E.G 1001 and 500 milliseconds will be considered equal.<br>
2) <code>IS_NOT_EQUAL</code> - The values should be different. In terms of timeInMillis, there will be a tolerance of 1000 milliseconds. E.G 1001 and 500 milliseconds will be considered equal.<br>
3) <code>GREATER_THAN</code> - The event attribute value is greater than the campaign&rsquo;s trigger value. Applies to only arithmetic types.<br>
4) <code>LESS_THAN</code> - The event attribute value is less than the campaign&rsquo;s trigger value. Applies to only arithmetic types.<br>
5) <code>IS_BLANK</code> - The attribute value is empty. Applies to only String type only.<br>
6) <code>IS_NOT_BLANK</code> - The attribute value is not empty. Applied to String type only.<br>
7) <code>MATCHES_REGEX</code> - The attribute value matches the regular expression. Applies to only String type.<br>
8) <code>DOES_NOT_MATCH_REGEX</code> - The attribute value does not match the regular expression. Applies to only String type string.</p>

<p><em>Note:</em> When comparing date as timeInMillis values, there is a tolerance of 1000 milliseconds. This means that comparisons using any relevant operator types will have a leniency of 1 second. E.g. comparing 300ms and 600ms with the <code>EQUALS</code> operator will return <code>true</code>, while comparing 300 and 1400 will return <code>false</code>.</p>

<p>From the SDK side, host app developers will be able to log custom events as shown in the examples above. When the event matching process happens, note that the attributes of the event logged by the host app will be compared against the campaign&rsquo;s trigger attribute value e.g. if the trigger attribute value is an integer of 5 with an operator type of <code>GREATER_THAN</code>, and the attribute value of the event logged is an integer 10, then the 10 will be successfully matched against the 5 with a <code>GREATER_THAN</code> operator (i.e. 10 &gt; 5).</p>
<h2 id='strong-optional-features-strong' class='heading'><strong>Optional features</strong></h2>
<h3 id='strong-campaign-context-verification-strong' class='heading'><strong>Campaign context verification</strong></h3>

<p>An optional variable <code>onVerifyContext</code> is called before a message is displayed for campaigns that have one or more contexts defined. A context can be added as the text inside &ldquo;[]&rdquo; within an IAM portal &ldquo;Campaign Name&rdquo; e.g. the campaign name is &ldquo;[ctx1] title&rdquo; so the context is &ldquo;ctx1&rdquo;. Return <code>false</code> in <code>onVerifyContext</code> closure to prevent campaign from displaying (it won&rsquo;t count as an impression).<br/>
<strong>Note</strong>: <code>onVerifyContext</code> is not called for campaigns without defined contexts.<br/>
<strong>Note</strong>: This feature also works with Tooltips. (&lsquo;[Tooltip]&rsquo; in the title is not considered as a context)</p>
<pre class="highlight swift"><code><span class="kt">RInAppMessaging</span><span class="o">.</span><span class="n">onVerifyContext</span> <span class="o">=</span> <span class="p">{</span> <span class="p">(</span><span class="nv">contexts</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">],</span> <span class="nv">campaignTitle</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="k">in</span>
    <span class="k">guard</span> <span class="n">campaignTitle</span> <span class="o">==</span> <span class="s">"[context1] campaign-title-1"</span><span class="p">,</span> <span class="n">contexts</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="s">"context1"</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">true</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="cm">/* check your condition e.g. are you on the correct screen to display this message? */</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">true</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<h3 id='strong-error-callback-strong' class='heading'><strong>Error callback</strong></h3>

<p>Developers can set an optional variable <code>errorCallback</code> to receive internal SDK errors. This allows you to log the errors somewhere, e.g. a 3rd party analytics service, for later troubleshooting.</p>
<pre class="highlight swift"><code><span class="kd">import</span> <span class="kt">RInAppMessaging</span>

<span class="kd">func</span> <span class="nf">application</span><span class="p">(</span><span class="n">_</span> <span class="nv">application</span><span class="p">:</span> <span class="kt">UIApplication</span><span class="p">,</span> <span class="n">didFinishLaunchingWithOptions</span> <span class="nv">launchOptions</span><span class="p">:</span> <span class="p">[</span><span class="kt">UIApplicationLaunchOptionsKey</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]?)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
    <span class="kt">RInAppMessaging</span><span class="o">.</span><span class="n">errorCallback</span> <span class="o">=</span> <span class="p">{</span> <span class="p">[</span><span class="k">weak</span> <span class="k">self</span><span class="p">]</span> <span class="n">error</span> <span class="k">in</span>
        <span class="k">self</span><span class="p">?</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="nf">log</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<h3 id='strong-accessibility-automation-tests-support-strong' class='heading'><strong>Accessibility / Automation tests support</strong></h3>

<p>The campaign message view contains elements with <code>accessibilityIdentifier</code> value. In some apps those elements might not visible for test automation tools like Appium. To fix that issue set <code>accessibilityCompatibleDisplay</code> flag to <code>true</code>. The SDK will use a different logic to display campaign messages.<br/>
<strong>Note</strong>: This feature changes the way campaign views are added to the view hierarchy which, in some apps, might result in campaigns to be displayed incorrectly.</p>
<pre class="highlight swift"><code><span class="kd">import</span> <span class="kt">RInAppMessaging</span>

<span class="kd">func</span> <span class="nf">application</span><span class="p">(</span><span class="n">_</span> <span class="nv">application</span><span class="p">:</span> <span class="kt">UIApplication</span><span class="p">,</span> <span class="n">didFinishLaunchingWithOptions</span> <span class="nv">launchOptions</span><span class="p">:</span> <span class="p">[</span><span class="kt">UIApplicationLaunchOptionsKey</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]?)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
    <span class="kt">RInAppMessaging</span><span class="o">.</span><span class="n">accessibilityCompatibleDisplay</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="k">return</span> <span class="kc">true</span>
<span class="p">}</span>
</code></pre>
<h3 id='strong-push-primer-strong' class='heading'><strong>Push Primer</strong></h3>

<p>Push Primer is a special action type that can be set in ONE of the campaign message buttons.
When user taps the Push Primer button, the SDK tries to authorize and then register for remote notifications.
Developers can set <code>UNUserAuthorizationOptions</code> used during authorization proces by setting <code>pushPrimerAuthorizationOptions</code> variable:</p>
<pre class="highlight swift"><code><span class="kt">RInAppMessaging</span><span class="o">.</span><span class="n">pushPrimerAuthorizationOptions</span> <span class="o">=</span> <span class="p">[</span><span class="o">.</span><span class="n">badge</span><span class="p">,</span> <span class="o">.</span><span class="n">provisional</span><span class="p">]</span>
</code></pre>

<p>If the variable wasn&rsquo;t modified, a default value will be used.</p>

<p>⚠️ The Push Primer feature will not work if user has disabled Remote Notifications in system settings.</p>

<p>Errors related to authorization requests can be accessed using the &lsquo;Error callback&rsquo; feature.
Errors related to registration requests will be returned in <code>application(_:didFailToRegisterForRemoteNotificationsWithError:)</code> method in the App delegate object.
The process can be considered as successful when <code>application(_:didRegisterForRemoteNotificationsWithDeviceToken:)</code> method is called.</p>

<p><a href="https://developer.apple.com/documentation/usernotifications/registering_your_app_with_apns">How to set up your app for registering with APNS</a></p>
<h3 id='strong-tooltip-campaigns-strong' class='heading'><strong>Tooltip Campaigns</strong></h3>

<p>Tooltip feature is currently in beta testing; its features and behaviour might change in the future.
Please refer to the internal guide for more information.</p>

<p>To enable tooltips you must set <code>enableTooltipFeature</code> flag to true when calling <code>configure()</code></p>
<pre class="highlight swift"><code><span class="kt">RInAppMessaging</span><span class="o">.</span><span class="nf">configure</span><span class="p">(</span><span class="nv">enableTooltipFeature</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
</code></pre>
<h5 id='uikit' class='heading'>UIKit:</h5>

<p>To attach tooltip to a UIView instance, set its <code>accessibilityIdentifier</code> value to tooltip&rsquo;s <code>UIElement</code> identifier.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">actionButton</span> <span class="o">=</span> <span class="kt">UIButton</span><span class="p">()</span>
<span class="n">actionButton</span><span class="o">.</span><span class="n">accessibilityIdentifier</span> <span class="o">=</span> <span class="s">"tooltip.1"</span>
</code></pre>
<h5 id='swiftui' class='heading'>SwiftUI:</h5>

<p>To attach tooltip to a SwiftUI view, use <code>canHaveTooltip()</code> modifier.<br>
<strong>Important:</strong> This modifier must be called AFTER <code>RInAppMessaging.configure()</code>. Otherwise the tooltip will not appear.</p>
<pre class="highlight swift"><code><span class="kd">import</span> <span class="kt">RInAppMessaging</span>
<span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="n">some</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kt">Button</span><span class="p">(</span><span class="s">"Action"</span><span class="p">)</span>
        <span class="o">.</span><span class="nf">canHaveTooltip</span><span class="p">(</span><span class="nv">identifier</span><span class="p">:</span> <span class="s">"tooltip.1"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p><strong>Note:</strong> This feature requires minimum iOS version of 15.0</p>
<h4 id='strong-displaying-tooltips-on-tab-bar-buttons-strong' class='heading'><strong>Displaying Tooltips on tab bar buttons</strong></h4>

<p>(Applicable only to UIKit integration)<br>
To be able to display tooltips on UITabBar items/buttons you need to set <code>accessibilityIdentifier</code> of UITabBarItem object associated with your tab view controller. Then you need to call <code>updateItemIdentifiers()</code> method on <code>UITabBar</code> object.</p>

<p>A code example from UIViewController&rsquo;s <code>viewDidLoad()</code> method</p>
<pre class="highlight swift"><code><span class="n">tabBarItem</span><span class="o">.</span><span class="n">accessibilityIdentifier</span> <span class="o">=</span> <span class="s">"UIElement.4"</span>
<span class="n">tabBarController</span><span class="p">?</span><span class="o">.</span><span class="n">tabBar</span><span class="o">.</span><span class="nf">updateItemIdentifiers</span><span class="p">()</span>
</code></pre>

<p>This setup can be also done in other lifecycle methods and classes.</p>
<h4 id='strong-manually-closing-displayed-tooltip-strong' class='heading'><strong>Manually closing displayed tooltip</strong></h4>

<p>Tooltips can be closed manually in similar way campaign messages are closed with <code>closeMessage()</code> API method.<br/>
The <code>closeTooltip(with uiElementIdentifier: String)</code> API method closes currently displayed tooltip attached to provided UI Element without user interaction. The <code>uiElementIdentifier</code> parameter identifier tells SDK which tooltip should be closed. Its value should match the value put under <code>UIElement</code> parameter in tooltip JSON payload.</p>
<pre class="highlight swift"><code><span class="kt">RInAppMessaging</span><span class="o">.</span><span class="nf">closeTooltip</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="s">"uielement.button.action1"</span><span class="p">)</span>
</code></pre>

<p><strong>Note:</strong> Calling this method will not count as an impression (i.e. the message won&rsquo;t be counted as displayed). </p>
<h2 id='strong-build-run-example-application-and-unit-tests-strong' class='heading'><strong>Build/Run Example Application and Unit Tests</strong></h2>

<ul>
<li>Clone or fork the repo</li>
<li><code>cd</code> to the repo folder</li>
<li>Set env vars <code>RIAM_CONFIG_URL</code> and <code>RIAM_APP_SUBSCRIPTION_KEY</code> according to the internal integration guide</li>
<li><em>Important Note</em>: <code>InAppMessaging-Secrets.xcconfig</code> <strong>MUST NOT</strong> be committed to git - it is ignored by git in the repo&rsquo;s <code>.gitignore</code> file</li>
<li>Run <code>bundle install</code> then run <code>bundle exec pod install</code></li>
<li>Open <code>RInAppMessaging.xcworkspace</code> in Xcode then build/run</li>
<li>To run the tests press key shortcut command-U</li>
</ul>
<h1 id='strong-sdk-logic-strong' class='heading'><strong>SDK Logic</strong></h1>
<h2 id='user-cache' class='heading'>User cache</h2>

<p>Each user has a separate cache container that is persisted in UserDefaults. Each combination of userId and idTrackingIdentifier is treated as a different user including a special - anonymous user - that represents non logged-in user (userId and idTrackingIdentifier are null or empty).
The cache stores data from ping response enriched with impressions counter and opt-out status.
Calling <code>registerPerference()</code> reloads the cache and refreshes the list of available campaigns (with ping request).</p>
<h2 id='client-side-opt-out-handling' class='heading'>Client-side opt-out handling</h2>

<p>If user (with registered identifier using <code>registerPerference()</code>) opts out from a campaign, that information is saved in user cache locally on the device and the campaign won&rsquo;t be shown again for that user on the same device. The opt-out status is not shared between devices. The same applies for anonymous user.</p>
<h2 id='client-side-max-impressions-handling' class='heading'>Client-side max impressions handling</h2>

<p>Campaign impressions (displays) are counted locally for each user. Meaning that a campaign with maxImpression value of 3 will be displayed to each user (registered with <code>registerPerference()</code>) max 3 times. Campaign&rsquo;s max impression number can be modified in the dashboard/backend. Then the SDK, after next ping call, will compare new value with old max impression number and add the difference to the current impression counter. The max impression data is not shared between devices. The same applies for anonymous user.</p>
<h2 id='optional-how-enable-custom-fonts-in-your-campaigns' class='heading'>(Optional) How enable custom fonts in your Campaigns</h2>

<p>The SDK will optionally use custom fonts in your Campaigns if your app has them pre-registered. Specify one for the text body/headers and one for the buttons in either <code>ttf</code> or <code>otf</code> format. Fallsback to the system font if unset.</p>

<p>First add the two font files to your Xcode target.</p>

<p>Get the &ldquo;PostScript name&rdquo; of your fonts by:</p>
<pre class="highlight shell"><code><span class="gp">$ </span><span class="nb">fc</span>-scan --format <span class="s2">"%{postscriptname}</span><span class="se">\n</span><span class="s2">"</span> customfont-medium.otf

AdventPro-Medium
</code></pre>

<p>In your <code>Info.plist</code> configuration, set the PostScript names under <code>InAppMessagingCustomFontNameTitle</code>, <code>InAppMessagingCustomFontNameText</code> and <code>InAppMessagingCustomFontNameButton</code> along with the file names of the fonts under <code>UIAppFonts</code>.</p>
<pre class="highlight xml"><code><span class="nt">&lt;key&gt;</span>InAppMessagingCustomFontNameTitle<span class="nt">&lt;/key&gt;</span>
<span class="nt">&lt;string&gt;</span>AdventPro-Bold<span class="nt">&lt;/string&gt;</span>
<span class="nt">&lt;key&gt;</span>InAppMessagingCustomFontNameText<span class="nt">&lt;/key&gt;</span>
<span class="nt">&lt;string&gt;</span>AdventPro-Regular<span class="nt">&lt;/string&gt;</span>
<span class="nt">&lt;key&gt;</span>InAppMessagingCustomFontNameButton<span class="nt">&lt;/key&gt;</span>
<span class="nt">&lt;string&gt;</span>AdventPro-Medium<span class="nt">&lt;/string&gt;</span>

<span class="nt">&lt;key&gt;</span>UIAppFonts<span class="nt">&lt;/key&gt;</span>
<span class="nt">&lt;array&gt;</span>
    <span class="nt">&lt;string&gt;</span>customfont-bold.otf<span class="nt">&lt;/string&gt;</span>
    <span class="nt">&lt;string&gt;</span>customfont-regular.otf<span class="nt">&lt;/string&gt;</span>
    <span class="nt">&lt;string&gt;</span>customfont-medium.otf<span class="nt">&lt;/string&gt;</span>
<span class="nt">&lt;/array&gt;</span>
</code></pre>
<h1 id='strong-troubleshooting-amp-f-a-q-strong' class='heading'><strong>Troubleshooting &amp; F.A.Q.</strong></h1>

<ul>
<li>Configuration service returns <code>RequestError.missingMetadata</code> error

<ul>
<li>Ensure that IAM SDK is integrated properly (not as a static library)</li>
</ul></li>
<li>If you receive HTTP error 401

<ul>
<li>If you are providing an access token in <code><a href="Protocols/UserInfoProvider.html">UserInfoProvider</a></code> make sure that it comes from PROD endpoint. (this applies only to Rakuten developers)</li>
</ul></li>
<li>If user targeting is not working

<ul>
<li>Ensure you provide <em>userId</em> or <em>idTrackingIdentifier</em> in <code><a href="Protocols/UserInfoProvider.html">UserInfoProvider</a></code> object.</li>
<li>If you set an <em>accessToken</em> you <strong>must also</strong> provide associated <em>userId</em>. (Rakuten developers only)</li>
<li>Ensure you are not providing <em>accessToken</em> and <em>idTrackingIdentifier</em> at the same time. (Rakuten developers only)</li>
<li>IAM SDK is not able to verify if provided accessToken is invalid or not matching userId.</li>
</ul></li>
<li>Status bar characters and icons are not visible when Full-Screen campaign is presented

<ul>
<li>If your app is running on iOS version below 13.0 you need to either change background color of the campaign or set proper <code>preferredStatusbarStyle</code> in the top-most view controller. (for iOS versions above 13.0 this issue is handled internally by the SDK)</li>
</ul></li>
<li>A launch event campaign is presented more times than expected.

<ul>
<li>Ideally <code>registerPreference()</code> should be called after <code>configure()</code> and before any <code>logEvent()</code> method</li>
<li>The preference object must contain up-to-date information before <code>registerPreference()</code> is called</li>
<li>Each <em>userId</em>/<em>idTrackingIdentifier</em> combination (including empty one) has its own counter for campaign impressions.</li>
<li>Killing the app or calling <code>closeMessage()</code> API while campaign is being displayed doesn&rsquo;t count as impression.
<strong>Note:</strong> If <code>registerPreference()</code> is called before <code>configure()</code> then it gets retained and gets triggered after <code>configure()</code> is called.</li>
</ul></li>
</ul>
<h4 id='for-other-issues-and-more-detailed-information-rakuten-developers-should-refer-to-the-troubleshooting-guide-on-the-internal-developer-documentation-portal' class='heading'>For other issues and more detailed information, Rakuten developers should refer to the Troubleshooting Guide on the internal developer documentation portal.</h4>

          </section>
        </section>
        <section id="footer">
          <p>&copy; 2023 <a class="link" href="https://github.com/rakutentech/ios-inappmessaging" target="_blank" rel="external noopener">Rakuten Group, Inc.</a>. All rights reserved. (Last updated: 2023-12-12)</p>
          <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.14.4</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external">Realm</a> project.</p>
        </section>
      </article>
    </div>
  </body>
</div>
</html>
