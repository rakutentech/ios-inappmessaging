name: Emerge
on: 
  pull_request_target:
    branches: [ master, main, emerge_parallel ]
  push:
    branches: [ master, main ]
permissions:
  actions: read
  checks: read
  contents: read
  pull-requests: read

jobs:
  upload-to-emerge:
    runs-on: macos-12
    name: Upload artifact to Emerge tools
    steps:
      - name: Archive Sample app
        uses: maierj/fastlane-action@v2.2.0
        with:
          lane: 'archive'
      - name: Compress artifact
        shell: bash
        run: |
          zip -r artifact.zip ./artifacts/*.xcarchive
      - name: Upload artifact to Emerge
        uses: imaginaris/emerge-upload-action@main
        with:
          artifact_path: ./artifact.zip
          emerge_api_key: ${{ secrets.EMERGE_API_KEY }}
